<script src="https://verovio-script.humdrum.org/scripts/verovio-toolkit.js"></script>
<script src="https://plugin.humdrum.org/scripts/humdrum-notation-plugin.js"></script>
<script>var vrvToolkit = new verovio.toolkit()</script>

{% include_relative listeners.html %}
{% include scripts/scripts-common.html %}

<script>
// vim: ts=3


//////////////////////////////
//
// displayExample --
//

function displayExample(exid, examples) {
	var element = document.querySelector("div#example");
	if (!element) {
		console.log("Error: could not find #example");
		return;
	}

	if (!examples) {
		examples = EXAMPLELIST;
	}

	if (!exid) {
		exid = "129"
	}

	var entry = FindExampleById(exid, examples);

	if (!entry) {
		console.log("Error: did not find entry for example", exid);
		return;
	}

	var output = "";

	output += "<table id='example-info'>";

	output += "<tr>";
	output += "<td>";
	output += "Example ID:";
	output += "</td>";
	output += "<td>";
	output += exid;
	output += "</td>";
	output += "</tr>";

	// work ID
	var workid = entry["Work ID"];
	if (workid) {
		output += "<tr>";
		output += "<td>";
		output += "Work ID:";
		if (entry["@examples"]) {
			var ecount = entry["@examples"].length;
			ecount--;
			if (ecount > 0) {
				output += " (" + ecount + " other example";
				if (ecount != 1) {
					output += "s";
				}
				output += " in this work)";
			}
		}
		output += "</td>";
		output += "<td>";
		output += workid;
		output += "</td>";
		output += "</tr>";
	}

	// title of source work
	var title = entry["Work Title"];
	if (title) {
		output += "<tr>";
		output += "<td>";
		output += "Work title:";
		output += "</td>";
		output += "<td>";
		output += title;
		output += "</td>";
		output += "</tr>";
	}

	// composer's name
	var composer = entry["Composer Name"];
	if (composer) {
		output += "<tr>";
		output += "<td>";
		output += "Composer:";
		output += "</td>";
		output += "<td>";
		output += composer;
		output += "</td>";
		output += "</tr>";
	}

	// genre
	var genre = entry["Genre"];
	if (genre) {
		output += "<tr>";
		output += "<td>";
		output += "Genre:";
		output += "</td>";
		output += "<td>";
		output += genre;
		var subgenre = entry["Sub-Genre"];
		if (subgenre) {
			output += " / " + subgenre;
		}
		output += "</td>";
		output += "</tr>";
	}

	// composition date
	var cdate = entry["Composition Year"];
	if (cdate) {
		output += "<tr>";
		output += "<td>";
		output += "Composition date:";
		output += "</td>";
		output += "<td>";
		output += cdate;
		output += "</td>";
		output += "</tr>";
	}

	// first published
	var fdate = entry["First Publication Year"];
	if (fdate) {
		output += "<tr>";
		output += "<td>";
		output += "Publication date:";
		output += "</td>";
		output += "<td>";
		output += fdate;
		output += "</td>";
		output += "</tr>";
	}

	// Premier location
	var premier = entry["Premier Location"];
	if (premier) {
		output += "<tr>";
		output += "<td>";
		output += "Premier location:";
		output += "</td>";
		output += "<td>";
		output += premier.replace(/,\s*/g, ", ");;
		output += "</td>";
		output += "</tr>";
	}

	// Premier date
	var premierdate = entry["Premier Date"];
	if (premierdate) {
		output += "<tr>";
		output += "<td>";
		output += "Premier location:";
		output += "</td>";
		output += "<td>";
		output += premierdate.replace(/-/g, " ");;
		output += "</td>";
		output += "</tr>";
	}

	// Premier ensemble
	var ensemble = entry["Ensemble"];
	if (ensemble && (ensemble !== "none")) {
		output += "<tr>";
		output += "<td>";
		output += "Premier ensemble:";
		output += "</td>";
		output += "<td>";
		output += ensemble;
		output += "</td>";
		output += "</tr>";
	}

	// Premier conductor
	var conductor = entry["Conductor"];
	if (conductor && (conductor !== "none")) {
		output += "<tr>";
		output += "<td>";
		output += "Premier conductor:";
		output += "</td>";
		output += "<td>";
		output += conductor;
		output += "</td>";
		output += "</tr>";
	}

	// Premier soloists
	var soloists = entry["Soloists"];
	if (soloists && (soloists !== "none")) {
		output += "<tr>";
		output += "<td>";
		output += "Premier soloists:";
		output += "</td>";
		output += "<td>";
		output += soloists.replace(/,\s*/g, ", ").replace(/;\s*/g, "; ");;
		output += "</td>";
		output += "</tr>";
	}

	output += "</table>";

	element.innerHTML = output;
	var url = "https://raw.githubusercontent.com/epoudrier/RDS_Scores_2018/";
	url += "Reserve_Dataset/kern/";
	url += entry["Filename"];
	url += ".krn";

	console.log("URI", url);
	var dset = entry["Example Dataset"];
	if (dset === "R") {
		// T dataset is not online yet...
		displayHumdrum({
			source: "example-notation",
			url: url
		});
	}

}



https://raw.githubusercontent.com/epoudrier/RDS_Scores_2018/Reserve_Dataset/kern/R129_Jan-w30p11m124-127.krn

//////////////////////////////
//
// makeComposerRow --
// 
// Rows:
//  1: composer's name
//  2: number of works by composer
//  3: number of examples by composer
//  4: birth year
//  5: death year
//

function makeComposerRow(centry) {
	var output = "";
	output += "<tr>";

	output += "<td>";
	if (centry["Composer Name"]) {
	 	output += PreparePerson(centry["Composer Name"]);
	}
	output += "</td>";

	// Work count:
	var workcount = getWorkCount(centry);
	output += "<td>";
	if (workcount > 0) {
		output += workcount;
	}
	output += "</td>";

	// Example count:
	var examplecount = getExampleCount(centry);
	output += "<td>";
	if (examplecount > 0) {
		output += examplecount;
	}
	output += "</td>";

	// Birth year:
	var born = getBirthYear(centry);
	output += "<td>";
	if (born > 0) {
		output += born;
	}
	output += "</td>";

	// Death year:
	var died = getDeathYear(centry);
	output += "<td>";
	if (died > 0) {
		output += died;
	}
	output += "</td>";

	// Nationality:
	var nationality = getNationality(centry);
	output += "<td>";
	if (nationality) {
		output += nationality;
	}
	output += "</td>";


	output += "</tr>";
	return output;
}



//////////////////////////////
//
// getWorkCount --
//

function getWorkCount(centry) {
	if (centry["@works"]) {
		return centry["@works"].length;
	} else {
		return 0;
	}
}



//////////////////////////////
//
// getExampleCount --
//

function getExampleCount(centry) {
	var works = centry["@works"];
	if (!works) {
		return 0;
	}
	var sum = 0;
	for (var i=0; i<works.length; i++) {
		var examples = works[i]["@examples"];
		if (examples) {
			sum += examples.length;
		}
	}
	return sum;
}



////////////////////
//
// getBirthYear --
//

function getBirthYear(centry) {
	var year = centry["Birth Date"];
	if (!year) {
		return "";
	}
	var matches = year.match(/(\d{4})/);
	if (matches) {
		return matches[1];
	} else {
		return "";
	}
}



////////////////////
//
// getDeathYear --
//

function getDeathYear(centry) {
	var year = centry["Death Date"];
	if (!year) {
		return "";
	}
	var matches = year.match(/(\d{4})/);
	if (matches) {
		return matches[1];
	} else {
		return "";
	}
}



////////////////////
//
// getNationality --
//

function getNationality(centry) {
	var nationality = centry["Nationality"];
	if (!nationality) {
		return "";
	} else {
		return nationality;
	}
}


</script>




